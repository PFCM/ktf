package {{.Package}}

// Code generated by github.com/pfcm/ktf/cmd/gen from {{.Name}},
// schema version {{.SchemaVersion}}
// DO NOT EDIT.

import (
       "fmt"

	"github.com/zclconf/go-cty/cty"
)

// Make sure resources with no list attributes don't cause build errors because
// of an unused import.
var _ = fmt.Sprintf

{{ $resource := .Name -}}
{{ range $i, $_ := .Blocks -}}
{{ if eq $i 0 -}}
func init() {
	register({{printf "%q" $resource}}, {{.Name}})
}
{{ end -}}
var {{ .Name }} = ConverterSpec {
	ResourceName: {{printf "%q" $resource}},
	Attributes: map[string]func(any) (cty.Value, error) {
{{ range $key, $value := .Attributes -}}
		{{ if .IsList -}}
		{{ printf "%q" $key }}: func(a any) (cty.Value, error) {
			l, ok := a.([]any)
			if !ok {
				return cty.Value{}, fmt.Errorf("expected slice, got: %T", a)
			}
			vl := make([]cty.Value, 0, len(l))
			for _, val := range l {
				v, err := {{ valueFunc .Second }}(val)
				if err != nil {
					return cty.Value{}, err
				}
				vl = append(vl, v)
			}
			return cty.ListVal(vl), nil
		},
		{{ else -}}
		{{printf "%q" $key }}: {{ valueFunc .First }},
		{{ end -}}
{{ end -}}
	},
	Blocks: map[string]ConverterSpec {
{{ range $key, $value := .Blocks -}}
 		{{ printf "%q" $key }}: {{ printf "%s" $value -}},
{{ end -}}
	},
}

{{ end }}